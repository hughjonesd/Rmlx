<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with Rmlx • Rmlx</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with Rmlx">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Rmlx</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started with Rmlx</a></li>
    <li><a class="dropdown-item" href="../articles/linear-regression.html">Linear Regression with MLX</a></li>
    <li><a class="dropdown-item" href="../articles/neural-networks.html">Neural Networks with Rmlx</a></li>
    <li><a class="dropdown-item" href="../articles/performance.html">Performance Benchmarks</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting Started with Rmlx</h1>
            
      

      <div class="d-none name"><code>getting-started.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Apple MLX (Machine Learning eXchange) is Apple’s high-performance
array and machine-learning framework for Apple Silicon, built on top of
Metal for GPU execution and optimized CPU kernels. It offers lazy
evaluation, vectorized math, automatic differentiation, and neural
network building blocks (see the <a href="https://ml-explore.github.io/mlx/" class="external-link">official MLX documentation</a>
for full details).</p>
<p><code>Rmlx</code> is a thin R layer over MLX that lets you:</p>
<ul>
<li>Create MLX tensors from R data (<code><a href="../reference/as_mlx.html">as_mlx()</a></code>).</li>
<li>Run GPU-accelerated math, linear algebra, FFTs, and reductions with
familiar R syntax.</li>
<li>Use automatic differentiation (<code><a href="../reference/mlx_grad.html">mlx_grad()</a></code>,
<code><a href="../reference/mlx_grad.html">mlx_value_grad()</a></code>) for optimization.</li>
<li>Build simple models with MLX modules and update them using SGD
helpers.</li>
</ul>
<p>All heavy computation stays in MLX land; you only copy back to base R
when you call functions like <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="system-requirements">System Requirements<a class="anchor" aria-label="anchor" href="#system-requirements"></a>
</h2>
<p>Before using Rmlx, ensure MLX is installed:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Using Homebrew (if available)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">brew</span> install mlx</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Or build from source</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/ml-explore/mlx.git</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="bu">cd</span> mlx <span class="kw">&amp;&amp;</span> <span class="fu">mkdir</span> build <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> build</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">cmake</span> .. <span class="kw">&amp;&amp;</span> <span class="fu">make</span> <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> make install</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-mlx-arrays">Creating MLX Arrays<a class="anchor" aria-label="anchor" href="#creating-mlx-arrays"></a>
</h2>
<p>Convert R objects to MLX arrays using <code><a href="../reference/as_mlx.html">as_mlx()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hughjonesd.github.io/Rmlx/">Rmlx</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'Rmlx'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     fft</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     chol2inv, colMeans, colSums, diag, outer, rowMeans, rowSums, svd</span></span>
<span></span>
<span><span class="co"># From a vector</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span></span>
<span><span class="co">#&gt; mlx array [10]</span></span>
<span><span class="co">#&gt;   dtype: float32</span></span>
<span><span class="co">#&gt;   device: gpu</span></span>
<span><span class="co">#&gt;   values:</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span></span>
<span><span class="co"># From a matrix</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; mlx array [3 x 4]</span></span>
<span><span class="co">#&gt;   dtype: float32</span></span>
<span><span class="co">#&gt;   device: gpu</span></span>
<span><span class="co">#&gt;   values:</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    1    4    7   10</span></span>
<span><span class="co">#&gt; [2,]    2    5    8   11</span></span>
<span><span class="co">#&gt; [3,]    3    6    9   12</span></span>
<span></span>
<span><span class="co"># Move the array to the GPU</span></span>
<span><span class="va">x_gpu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="va">m</span>, device <span class="op">=</span> <span class="st">"gpu"</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>Precision note:</strong> Numeric inputs are stored in single
precision (<code>float32</code>). Requesting
<code>dtype = "float64"</code> will downcast the input with a warning.
Logical inputs are stored as MLX <code>bool</code> tensors (logical
<code>NA</code> values are not supported). Complex inputs are stored as
<code>complex64</code> (single-precision real and imaginary parts). Use
base R arrays if you need double precision arithmetic.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="lazy-evaluation">Lazy Evaluation<a class="anchor" aria-label="anchor" href="#lazy-evaluation"></a>
</h2>
<p>MLX arrays use lazy evaluation - operations are recorded but not
computed until needed:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># These operations are not computed immediately</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">101</span><span class="op">:</span><span class="fl">200</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Force evaluation of a specific array</span></span>
<span><span class="fu"><a href="../reference/mlx_eval.html">mlx_eval</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or convert to R (automatically evaluates)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]</span></span>
<span><span class="co">#&gt;  [1,]  203  233  263  293  323  353  383  413  443   473</span></span>
<span><span class="co">#&gt;  [2,]  206  236  266  296  326  356  386  416  446   476</span></span>
<span><span class="co">#&gt;  [3,]  209  239  269  299  329  359  389  419  449   479</span></span>
<span><span class="co">#&gt;  [4,]  212  242  272  302  332  362  392  422  452   482</span></span>
<span><span class="co">#&gt;  [5,]  215  245  275  305  335  365  395  425  455   485</span></span>
<span><span class="co">#&gt;  [6,]  218  248  278  308  338  368  398  428  458   488</span></span>
<span><span class="co">#&gt;  [7,]  221  251  281  311  341  371  401  431  461   491</span></span>
<span><span class="co">#&gt;  [8,]  224  254  284  314  344  374  404  434  464   494</span></span>
<span><span class="co">#&gt;  [9,]  227  257  287  317  347  377  407  437  467   497</span></span>
<span><span class="co">#&gt; [10,]  230  260  290  320  350  380  410  440  470   500</span></span>
<span></span>
<span><span class="co"># Wait for all queued work on the GPU if needed</span></span>
<span><span class="fu"><a href="../reference/mlx_synchronize.html">mlx_synchronize</a></span><span class="op">(</span><span class="st">"gpu"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="arithmetic-operations">Arithmetic Operations<a class="anchor" aria-label="anchor" href="#arithmetic-operations"></a>
</h2>
<p>Rmlx supports standard arithmetic operators:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">13</span><span class="op">:</span><span class="fl">24</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Element-wise operations</span></span>
<span><span class="va">sum_xy</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span><span class="va">diff_xy</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">-</span> <span class="va">y</span></span>
<span><span class="va">prod_xy</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span></span>
<span><span class="va">quot_xy</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">/</span> <span class="va">y</span></span>
<span><span class="va">pow_xy</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">^</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Convert back to R to see results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">sum_xy</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]   14   20   26   32</span></span>
<span><span class="co">#&gt; [2,]   16   22   28   34</span></span>
<span><span class="co">#&gt; [3,]   18   24   30   36</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="matrix-operations">Matrix Operations<a class="anchor" aria-label="anchor" href="#matrix-operations"></a>
</h2>
<div class="section level3">
<h3 id="matrix-multiplication">Matrix Multiplication<a class="anchor" aria-label="anchor" href="#matrix-multiplication"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Matrix multiplication</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]   22   49</span></span>
<span><span class="co">#&gt; [2,]   28   64</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transpose">Transpose<a class="anchor" aria-label="anchor" href="#transpose"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; mlx array [4 x 3]</span></span>
<span><span class="co">#&gt;   dtype: float32</span></span>
<span><span class="co">#&gt;   device: gpu</span></span>
<span><span class="co">#&gt;   values:</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]    1    2    3</span></span>
<span><span class="co">#&gt; [2,]    4    5    6</span></span>
<span><span class="co">#&gt; [3,]    7    8    9</span></span>
<span><span class="co">#&gt; [4,]   10   11   12</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cross-products">Cross Products<a class="anchor" aria-label="anchor" href="#cross-products"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>, <span class="fl">5</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">true_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">true_w</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loss must stay entirely in MLX-land: no conversions back to base R</span></span>
<span><span class="va">loss</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">data_x</span>, <span class="va">data_y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">preds</span> <span class="op">&lt;-</span> <span class="va">data_x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span></span>
<span>  <span class="va">resids</span> <span class="op">&lt;-</span> <span class="va">preds</span> <span class="op">-</span> <span class="va">data_y</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">resids</span> <span class="op">*</span> <span class="va">resids</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data_y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">grads</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlx_grad.html">mlx_grad</a></span><span class="op">(</span><span class="va">loss</span>, <span class="va">w</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wrong: converting to base R breaks the gradient</span></span>
<span><span class="va">bad_loss</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">data_x</span>, <span class="va">data_y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data_x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">)</span>  <span class="co"># leaves MLX</span></span>
<span>  <span class="va">resids</span> <span class="op">&lt;-</span> <span class="va">preds</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data_y</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">resids</span> <span class="op">*</span> <span class="va">resids</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">resids</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="../reference/mlx_grad.html">mlx_grad</a></span><span class="op">(</span><span class="va">bad_loss</span>, <span class="va">w</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir) : </span></span>
<span><span class="co">#&gt;   MLX autograd failed to differentiate the function: Gradient function must return an `mlx` object. Ensure your closure keeps computations in MLX or wraps the result with as_mlx().</span></span>
<span><span class="co">#&gt; Ensure all differentiable computations use MLX operations.</span></span>
<span></span>
<span><span class="co"># A small SGD loop using the module/optimizer helpers</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlx_linear.html">mlx_linear</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, bias <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># learns a single weight vector</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlx_parameters.html">mlx_parameters</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlx_optimizer_sgd.html">mlx_optimizer_sgd</a></span><span class="op">(</span><span class="va">parameters</span>, lr <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">loss_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>, <span class="va">data_x</span>, <span class="va">data_y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlx_param_values.html">mlx_param_values</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu">loss</span><span class="op">(</span><span class="va">theta</span>, <span class="va">data_x</span>, <span class="va">data_y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">loss_history</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">step</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">loss_history</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">step_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlx_train_step.html">mlx_train_step</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">loss_fn</span>, <span class="va">opt</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">loss_history</span><span class="op">[</span><span class="va">step</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">step_res</span><span class="op">$</span><span class="va">loss</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check final loss and inspect learned parameters</span></span>
<span><span class="va">final_loss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlx_forward.html">mlx_forward</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">residual_mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">final_loss</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">final_loss</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">residual_mse</span></span>
<span><span class="co">#&gt; [1] 5.658819e-05</span></span>
<span><span class="va">loss_history</span></span>
<span><span class="co">#&gt;  [1] 8.308889e+00 4.272983e+00 2.288200e+00 1.283615e+00 7.582743e-01</span></span>
<span><span class="co">#&gt;  [6] 4.726674e-01 3.102017e-01 2.130744e-01 1.520021e-01 1.117421e-01</span></span>
<span><span class="co">#&gt; [11] 8.408680e-02 6.443550e-02 5.009037e-02 3.939489e-02 3.128565e-02</span></span>
<span><span class="co">#&gt; [16] 2.505323e-02 2.020860e-02 1.640565e-02 1.339452e-02 1.099170e-02</span></span>
<span><span class="co">#&gt; [21] 9.060724e-03 7.498934e-03 6.228307e-03 5.189063e-03 4.335000e-03</span></span>
<span><span class="co">#&gt; [26] 3.630075e-03 3.046037e-03 2.560509e-03 2.155664e-03 1.817213e-03</span></span>
<span><span class="co">#&gt; [31] 1.533631e-03 1.295554e-03 1.095328e-03 9.267041e-04 7.845016e-04</span></span>
<span><span class="co">#&gt; [36] 6.644622e-04 5.630297e-04 4.772589e-04 4.046760e-04 3.432218e-04</span></span>
<span><span class="co">#&gt; [41] 2.911653e-04 2.470508e-04 2.096552e-04 1.779418e-04 1.510463e-04</span></span>
<span><span class="co">#&gt; [46] 1.282235e-04 1.088608e-04 9.242821e-05 7.848036e-05 6.664058e-05</span></span>
<span></span>
<span><span class="va">learned_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlx_param_values.html">mlx_param_values</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">learned_w</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]</span></span>
<span><span class="co">#&gt; [1,]  1.9941052</span></span>
<span><span class="co">#&gt; [2,] -1.0081218</span></span>
<span><span class="co">#&gt; [3,]  0.4934084</span></span>
<span><span class="co">#&gt; [4,]  0.2496413</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">true_w</span><span class="op">)</span></span>
<span><span class="co">#&gt;       [,1]</span></span>
<span><span class="co">#&gt; [1,]  2.00</span></span>
<span><span class="co">#&gt; [2,] -1.00</span></span>
<span><span class="co">#&gt; [3,]  0.50</span></span>
<span><span class="co">#&gt; [4,]  0.25</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="reductions">Reductions<a class="anchor" aria-label="anchor" href="#reductions"></a>
</h2>
<p>Compute summaries across arrays:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overall reductions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; mlx array []</span></span>
<span><span class="co">#&gt;   dtype: float32</span></span>
<span><span class="co">#&gt;   device: gpu</span></span>
<span><span class="co">#&gt;   values:</span></span>
<span><span class="co">#&gt; [1] 5050</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; mlx array []</span></span>
<span><span class="co">#&gt;   dtype: float32</span></span>
<span><span class="co">#&gt;   device: gpu</span></span>
<span><span class="co">#&gt;   values:</span></span>
<span><span class="co">#&gt; [1] 50.5</span></span>
<span></span>
<span><span class="co"># Column and row means</span></span>
<span><span class="fu"><a href="../reference/colMeans.html">colMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; mlx array [10]</span></span>
<span><span class="co">#&gt;   dtype: float32</span></span>
<span><span class="co">#&gt;   device: gpu</span></span>
<span><span class="co">#&gt;   values:</span></span>
<span><span class="co">#&gt;  [1]  5.5 15.5 25.5 35.5 45.5 55.5 65.5 75.5 85.5 95.5</span></span>
<span><span class="fu"><a href="../reference/rowMeans.html">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; mlx array [10]</span></span>
<span><span class="co">#&gt;   dtype: float32</span></span>
<span><span class="co">#&gt;   device: gpu</span></span>
<span><span class="co">#&gt;   values:</span></span>
<span><span class="co">#&gt;  [1] 46 47 48 49 50 51 52 53 54 55</span></span>
<span></span>
<span><span class="co"># Convert to R to see values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="../reference/colMeans.html">colMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  5.5 15.5 25.5 35.5 45.5 55.5 65.5 75.5 85.5 95.5</span></span>
<span></span>
<span><span class="co"># Cumulative operations flatten the array in column-major order</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   [1]    1    3    6   10   15   21   28   36   45   55   66   78   91  105  120</span></span>
<span><span class="co">#&gt;  [16]  136  153  171  190  210  231  253  276  300  325  351  378  406  435  465</span></span>
<span><span class="co">#&gt;  [31]  496  528  561  595  630  666  703  741  780  820  861  903  946  990 1035</span></span>
<span><span class="co">#&gt;  [46] 1081 1128 1176 1225 1275 1326 1378 1431 1485 1540 1596 1653 1711 1770 1830</span></span>
<span><span class="co">#&gt;  [61] 1891 1953 2016 2080 2145 2211 2278 2346 2415 2485 2556 2628 2701 2775 2850</span></span>
<span><span class="co">#&gt;  [76] 2926 3003 3081 3160 3240 3321 3403 3486 3570 3655 3741 3828 3916 4005 4095</span></span>
<span><span class="co">#&gt;  [91] 4186 4278 4371 4465 4560 4656 4753 4851 4950 5050</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="indexing">Indexing<a class="anchor" aria-label="anchor" href="#indexing"></a>
</h2>
<p>Subset MLX arrays similar to R:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select rows and columns</span></span>
<span><span class="va">x_sub</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Select specific row</span></span>
<span><span class="va">row_1</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Select specific column</span></span>
<span><span class="va">col_1</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="device-management">Device Management<a class="anchor" aria-label="anchor" href="#device-management"></a>
</h2>
<p>Control whether computations run on GPU or CPU:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check default device</span></span>
<span><span class="fu"><a href="../reference/mlx_default_device.html">mlx_default_device</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "gpu"</span></span>
<span></span>
<span><span class="co"># Set to CPU for debugging</span></span>
<span><span class="fu"><a href="../reference/mlx_default_device.html">mlx_default_device</a></span><span class="op">(</span><span class="st">"cpu"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "cpu"</span></span>
<span></span>
<span><span class="co"># Create array on CPU</span></span>
<span><span class="va">x_cpu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, device <span class="op">=</span> <span class="st">"cpu"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set back to GPU</span></span>
<span><span class="fu"><a href="../reference/mlx_default_device.html">mlx_default_device</a></span><span class="op">(</span><span class="st">"gpu"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "gpu"</span></span></code></pre></div>
<p>Remember that numeric computations are always performed in
<code>float32</code>; the CPU mode is useful when you need to compare
against base R or debug without a GPU.</p>
</div>
<div class="section level2">
<h2 id="performance-comparison">Performance Comparison<a class="anchor" aria-label="anchor" href="#performance-comparison"></a>
</h2>
<p>Here’s a simple timing comparison for large matrix
multiplication:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># R base</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">r_result</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">m2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MLX</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_mlx.html">as_mlx</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/mlx_eval.html">mlx_eval</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/mlx_eval.html">mlx_eval</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">mlx_result</span> <span class="op">&lt;-</span> <span class="va">x1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x2</span></span>
<span>  <span class="fu"><a href="../reference/mlx_eval.html">mlx_eval</a></span><span class="op">(</span><span class="va">mlx_result</span><span class="op">)</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mlx_result</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Base R:"</span>, <span class="va">t1</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Base R: 0.343 seconds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"MLX:"</span>, <span class="va">t2</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; MLX: 0.01 seconds</span></span></code></pre></div>
<p>Note: This is an informal comparison, not a rigorous benchmark.
Performance gains depend on array size, operation type, and
hardware.</p>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Keep data on GPU</strong>: Minimize transfers between R and
MLX</li>
<li>
<strong>Use lazy evaluation</strong>: Build computation graphs
before evaluating</li>
<li>
<strong>Batch operations</strong>: Combine operations before forcing
evaluation</li>
<li>
<strong>Monitor memory</strong>: GPU memory is limited; free unused
arrays</li>
<li>
<strong>Start with CPU</strong>: Use CPU device for debugging, then
switch to GPU</li>
</ol>
</div>
<div class="section level2">
<h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p>Current limitations in this initial version:</p>
<ul>
<li>Apple Silicon only (no Intel Mac or other platforms)</li>
<li>2D arrays (matrices) are primary focus</li>
<li>Limited indexing operations</li>
<li>No autodiff or gradient computation (planned for future
release)</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Hugh-Jones.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
