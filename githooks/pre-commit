#!/usr/bin/env bash
set -euo pipefail

REPO_ROOT="$(git rev-parse --show-toplevel)"
BENCH_SCRIPT="$REPO_ROOT/dev/benchmarks/run_benchmarks_cli.R"
OUTPUT_FILE="$REPO_ROOT/dev/benchmarks/bench_results.tsv"

if [ ! -x "$BENCH_SCRIPT" ]; then
  echo "Benchmark script not found at $BENCH_SCRIPT" >&2
  exit 1
fi

echo "[pre-commit] Running MLX benchmarks..."
Rscript "$BENCH_SCRIPT" > "$OUTPUT_FILE"
echo "[pre-commit] Benchmark TSV updated at $OUTPUT_FILE"
echo "[pre-commit] Latest benchmark results:" >&2
cat "$OUTPUT_FILE" >&2
git add "$OUTPUT_FILE"
