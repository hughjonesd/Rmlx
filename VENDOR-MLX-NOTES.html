<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Vendoring MLX - Experimental Branch • Rmlx</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Vendoring MLX - Experimental Branch"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">Rmlx</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hughjonesd/Rmlx/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Vendoring MLX - Experimental Branch</h1>
      <small class="dont-index">Source: <a href="https://github.com/hughjonesd/Rmlx/blob/master/VENDOR-MLX-NOTES.md" class="external-link"><code>VENDOR-MLX-NOTES.md</code></a></small>
    </div>

<div id="vendoring-mlx---experimental-branch" class="section level1">

<p>This branch now vendors MLX on-demand: configure first looks for a system MLX installation and, if missing, downloads MLX v0.30.0 from GitHub, supporting both Metal (macOS) and CUDA (Linux) builds alongside CPU.</p>
<div class="section level2">
<h2 id="what-was-done">What Was Done<a class="anchor" aria-label="anchor" href="#what-was-done"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>On-demand MLX source</strong>: Download MLX v0.30.0 into <code>build/mlx-src/</code> when needed</li>
<li>
<strong>Added copyright attribution</strong>: Created <code>inst/COPYRIGHTS</code> with MLX’s MIT license</li>
<li>
<strong>Updated DESCRIPTION</strong>: Credits Apple Inc. for the MLX code downloaded at install time</li>
<li>
<strong>configure script</strong>: Builds MLX from source via CMake when system MLX is absent
<ul><li>Always builds CPU backend</li>
<li>Prefers Metal backend on Apple Silicon when the <code>metal</code> tool is available</li>
<li>Falls back to CUDA backend on Linux when <code>nvcc</code> is present</li>
<li>Otherwise builds CPU-only</li>
</ul></li>
<li>
<strong>Updated cleanup script</strong>: Removes all generated build artifacts</li>
</ol></div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a></h2>
<ul><li>macOS on Apple Silicon (M1 or later)</li>
<li>CMake 3.24 or later</li>
<li>C++17 compiler</li>
<li>
<strong>Full Xcode</strong> (not just Command Line Tools)</li>
</ul></div>
<div class="section level2">
<h2 id="key-finding-metal-compiler-requirement">Key Finding: Metal Compiler Requirement<a class="anchor" aria-label="anchor" href="#key-finding-metal-compiler-requirement"></a></h2>
<p><strong>The metal shader compiler tool requires full Xcode, not just Command Line Tools.</strong></p>
<p>During MLX compilation, the build process needs to compile Metal shaders (<code>.metal</code> files) using the <code>metal</code> and <code>metallib</code> tools. These are only available in full Xcode installations, not in the minimal Command Line Tools package.</p>
<p>Error encountered:</p>
<pre><code>xcrun: error: unable to find utility "metal", not a developer tool or in PATH</code></pre>
</div>
<div class="section level2">
<h2 id="implications">Implications<a class="anchor" aria-label="anchor" href="#implications"></a></h2>
<div class="section level3">
<h3 id="for-cran-submission">For CRAN Submission<a class="anchor" aria-label="anchor" href="#for-cran-submission"></a></h3>
<ul><li>CRAN’s build systems may not have full Xcode installed</li>
<li>Requiring full Xcode (&gt;10 GB download) is a significant barrier for users</li>
<li>Most R users only have Command Line Tools installed</li>
</ul></div>
<div class="section level3">
<h3 id="alternative-approaches">Alternative Approaches<a class="anchor" aria-label="anchor" href="#alternative-approaches"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Keep current approach</strong> (require system MLX)
<ul><li>Users install MLX via <code>brew install mlx</code>
</li>
<li>Package remains small</li>
<li>No complex build process</li>
<li>✅ Currently working approach</li>
</ul></li>
<li>
<strong>Pre-compile MLX Metal shaders</strong>
<ul><li>Bundle pre-compiled <code>.metallib</code> files</li>
<li>Still build C++ portions from source</li>
<li>Reduces Xcode requirement</li>
<li>⚠️ Would need testing across macOS versions</li>
</ul></li>
<li>
<strong>Provide pre-built binaries</strong> (not CRAN-compatible)
<ul><li>Bundle pre-compiled <code>libmlx.a</code>
</li>
<li>Fastest installation</li>
<li>❌ CRAN doesn’t accept binary-only packages</li>
</ul></li>
</ol></div>
</div>
<div class="section level2">
<h2 id="recommendation">Recommendation<a class="anchor" aria-label="anchor" href="#recommendation"></a></h2>
<p><strong>Do not check MLX source into this repo.</strong> Instead, ship a configure step that prefers system MLX (Homebrew, distro packages, etc.) and otherwise downloads the exact upstream tarball on demand. This keeps the package small, avoids forcing all users to install full Xcode, and still enables Metal/CUDA features when the tooling is present.</p>
</div>
<div class="section level2">
<h2 id="files-in-this-branch">Files in This Branch<a class="anchor" aria-label="anchor" href="#files-in-this-branch"></a></h2>
<ul><li>
<code>configure</code>: Downloads MLX v0.30.0 on demand and builds it with CMake</li>
<li>
<code>cleanup</code>: Removes downloaded source/build artifacts (<code>build/mlx-*</code>)</li>
<li>
<code>inst/COPYRIGHTS</code>: MLX license attribution</li>
<li>
<code>DESCRIPTION</code>: Credits Apple Inc. for the MLX sources fetched during install</li>
</ul></div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">git</span> checkout experiment-vendor-mlx</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">./configure</span>   <span class="co"># auto-detects MLX or downloads it</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">R</span> CMD INSTALL .</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a></h2>
<p>Shipping the upstream MLX source in the repository was impractical (required full Xcode, bloated the tarball, and complicated maintenance). The current approach auto-detects system MLX and otherwise fetches the exact upstream release tarball during installation, keeping the package lightweight while still supporting Metal, CUDA, and CPU builds.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Hugh-Jones.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

